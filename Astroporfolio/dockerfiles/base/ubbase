FROM ubuntu

ARG PROYECTO
ARG USUARIO
ARG TIPO
ARG USER_NAME
ARG USER_PASS


RUN apt update && apt install -yq --no-install-recommends \
    apache2 \
    curl \
    nano \
    openssh-server \
    sudo \
    net-tools iputils-ping


RUN useradd -rm -d /home/${USER_NAME} -s /bin/bash ${USER_NAME}
RUN echo "${USER_NAME}:${USER_PASS}" | chpasswd

COPY ./proyectos/${TIPO}/${PROYECTO}/src /var/www/html/


RUN mkdir -p /root/admin
COPY ./dockerfiles/base/admin /root/admin
RUN chmod +x /root/admin/start.sh

EXPOSE 80 22

WORKDIR /root/admin
ENTRYPOINT ["./start.sh"]